{% extends "base.html" %} {% block title %}Welcome{% endblock %} {% block
content %}
<div class="content-wrapper">
  <h2>What is on your mind?</h2>
  <form method="POST" enctype="multipart/form-data">
    <div class="form-group">
      <input
        type="text"
        name="title"
        id="title"
        class="form-control"
        style="height: 50px"
        placeholder="Enter title for your journal"
      />
    </div>
    <br />
    <div class="form-group">
      <textarea
        name="body"
        id="body"
        class="form-control"
        style="height: 100px"
        placeholder="What's on your mind?"
      ></textarea>
      <div class="form-group">
        <span>Click 'Record' to transcribe</span>
        <button type="button" id="recordButton" class="btn btn-journal">
          Record
        </button>
        <button type="button" id="stopButton" class="btn btn-danger" disabled>
          Stop
        </button>
      </div>
    </div>
    <div class="mood-selector">
      <label class="mood-label">
        <input type="radio" name="mood" value="1" />
        <span class="mood-emoji">😞</span>
      </label>
      <label class="mood-label">
        <input type="radio" name="mood" value="2" />
        <span class="mood-emoji">🙁</span>
      </label>
      <label class="mood-label">
        <input type="radio" name="mood" value="3" />
        <span class="mood-emoji">😐</span>
      </label>
      <label class="mood-label">
        <input type="radio" name="mood" value="4" />
        <span class="mood-emoji">🙂</span>
      </label>
      <label class="mood-label">
        <input type="radio" name="mood" value="5" />
        <span class="mood-emoji">😆</span>
      </label>
    </div>
    <div class="form-group">
      <label for="image_file" class="form-label">upload a journal image</label>
      <input
        type="file"
        name="image_file"
        id="image_file"
        class="form-control form-control-lg"
        placeholder="Select image file"
      />
    </div>
    <button type="submit" class="btn-journal">Add journal entry</button>
  </form>
</div>

<script>
  const recordButton = document.getElementById("recordButton");
  const stopButton = document.getElementById("stopButton");
  const transcription = document.getElementById("body");
  let recognition;
  let isRecording = false;

  if ("webkitSpeechRecognition" in window) {
    recognition = new webkitSpeechRecognition();
  } else if ("SpeechRecognition" in window) {
    recognition = new SpeechRecognition();
  } else {
    console.log("Speech recognition not supported");
  }

  // Set continuous mode and interim results
  recognition.continuous = true;
  recognition.interimResults = true;

  recordButton.addEventListener("click", () => {
    if (!isRecording) {
      recognition.start();
      recordButton.disabled = true;
      stopButton.disabled = false;
      isRecording = true;
    }
  });

  stopButton.addEventListener("click", () => {
    if (isRecording) {
      recognition.stop();
      recordButton.disabled = false;
      stopButton.disabled = true;
      isRecording = false;
    }
  });

  recognition.onresult = (event) => {
    let transcript = "";
    for (let i = event.resultIndex; i < event.results.length; i++) {
      if (event.results[i].isFinal) {
        transcript += event.results[i][0].transcript;
      }
    }
    transcription.value += transcript;
  };

  recognition.onerror = (event) => {
    console.error("Speech recognition error:", event.error);
  };

  recognition.onend = () => {
    if (isRecording) {
      recognition.start();
    }
  };
</script>

{% endblock %}
